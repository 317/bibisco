<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bibisco.dao.client.ProjectMapper">
  <resultMap id="BaseResultMap" type="com.bibisco.dao.model.Project">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    <id column="ID_PROJECT" jdbcType="VARCHAR" property="idProject" />
    <result column="NAME" jdbcType="VARCHAR" property="name" />
    <result column="LANGUAGE" jdbcType="VARCHAR" property="language" />
    <result column="FABULA_TASK_STATUS" jdbcType="INTEGER" property="fabulaTaskStatus" />
    <result column="PREMISE_TASK_STATUS" jdbcType="INTEGER" property="premiseTaskStatus" />
    <result column="SETTING_TASK_STATUS" jdbcType="INTEGER" property="settingTaskStatus" />
    <result column="STRAND_TASK_STATUS" jdbcType="INTEGER" property="strandTaskStatus" />
    <result column="BIBISCO_VERSION" jdbcType="VARCHAR" property="bibiscoVersion" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.bibisco.dao.model.ProjectWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    <result column="FABULA" jdbcType="CLOB" property="fabula" />
    <result column="PREMISE" jdbcType="CLOB" property="premise" />
    <result column="SETTING" jdbcType="CLOB" property="setting" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    ID_PROJECT, NAME, LANGUAGE, FABULA_TASK_STATUS, PREMISE_TASK_STATUS, SETTING_TASK_STATUS, 
    STRAND_TASK_STATUS, BIBISCO_VERSION
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    FABULA, PREMISE, SETTING
  </sql>
  <select id="selectByExampleWithBLOBs" parameterType="com.bibisco.dao.model.ProjectExample" resultMap="ResultMapWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from PUBLIC.PROJECT
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByExample" parameterType="com.bibisco.dao.model.ProjectExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from PUBLIC.PROJECT
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="ResultMapWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from PUBLIC.PROJECT
    where ID_PROJECT = #{idProject,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    delete from PUBLIC.PROJECT
    where ID_PROJECT = #{idProject,jdbcType=VARCHAR}
  </delete>
  <delete id="deleteByExample" parameterType="com.bibisco.dao.model.ProjectExample">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    delete from PUBLIC.PROJECT
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.bibisco.dao.model.ProjectWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    insert into PUBLIC.PROJECT (ID_PROJECT, NAME, LANGUAGE, 
      FABULA_TASK_STATUS, PREMISE_TASK_STATUS, SETTING_TASK_STATUS, 
      STRAND_TASK_STATUS, BIBISCO_VERSION, FABULA, 
      PREMISE, SETTING)
    values (#{idProject,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{language,jdbcType=VARCHAR}, 
      #{fabulaTaskStatus,jdbcType=INTEGER}, #{premiseTaskStatus,jdbcType=INTEGER}, #{settingTaskStatus,jdbcType=INTEGER}, 
      #{strandTaskStatus,jdbcType=INTEGER}, #{bibiscoVersion,jdbcType=VARCHAR}, #{fabula,jdbcType=CLOB}, 
      #{premise,jdbcType=CLOB}, #{setting,jdbcType=CLOB})
  </insert>
  <insert id="insertSelective" parameterType="com.bibisco.dao.model.ProjectWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    insert into PUBLIC.PROJECT
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="idProject != null">
        ID_PROJECT,
      </if>
      <if test="name != null">
        NAME,
      </if>
      <if test="language != null">
        LANGUAGE,
      </if>
      <if test="fabulaTaskStatus != null">
        FABULA_TASK_STATUS,
      </if>
      <if test="premiseTaskStatus != null">
        PREMISE_TASK_STATUS,
      </if>
      <if test="settingTaskStatus != null">
        SETTING_TASK_STATUS,
      </if>
      <if test="strandTaskStatus != null">
        STRAND_TASK_STATUS,
      </if>
      <if test="bibiscoVersion != null">
        BIBISCO_VERSION,
      </if>
      <if test="fabula != null">
        FABULA,
      </if>
      <if test="premise != null">
        PREMISE,
      </if>
      <if test="setting != null">
        SETTING,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="idProject != null">
        #{idProject,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="language != null">
        #{language,jdbcType=VARCHAR},
      </if>
      <if test="fabulaTaskStatus != null">
        #{fabulaTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="premiseTaskStatus != null">
        #{premiseTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="settingTaskStatus != null">
        #{settingTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="strandTaskStatus != null">
        #{strandTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="bibiscoVersion != null">
        #{bibiscoVersion,jdbcType=VARCHAR},
      </if>
      <if test="fabula != null">
        #{fabula,jdbcType=CLOB},
      </if>
      <if test="premise != null">
        #{premise,jdbcType=CLOB},
      </if>
      <if test="setting != null">
        #{setting,jdbcType=CLOB},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.bibisco.dao.model.ProjectExample" resultType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    select count(*) from PUBLIC.PROJECT
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    update PUBLIC.PROJECT
    <set>
      <if test="record.idProject != null">
        ID_PROJECT = #{record.idProject,jdbcType=VARCHAR},
      </if>
      <if test="record.name != null">
        NAME = #{record.name,jdbcType=VARCHAR},
      </if>
      <if test="record.language != null">
        LANGUAGE = #{record.language,jdbcType=VARCHAR},
      </if>
      <if test="record.fabulaTaskStatus != null">
        FABULA_TASK_STATUS = #{record.fabulaTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="record.premiseTaskStatus != null">
        PREMISE_TASK_STATUS = #{record.premiseTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="record.settingTaskStatus != null">
        SETTING_TASK_STATUS = #{record.settingTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="record.strandTaskStatus != null">
        STRAND_TASK_STATUS = #{record.strandTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="record.bibiscoVersion != null">
        BIBISCO_VERSION = #{record.bibiscoVersion,jdbcType=VARCHAR},
      </if>
      <if test="record.fabula != null">
        FABULA = #{record.fabula,jdbcType=CLOB},
      </if>
      <if test="record.premise != null">
        PREMISE = #{record.premise,jdbcType=CLOB},
      </if>
      <if test="record.setting != null">
        SETTING = #{record.setting,jdbcType=CLOB},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExampleWithBLOBs" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    update PUBLIC.PROJECT
    set ID_PROJECT = #{record.idProject,jdbcType=VARCHAR},
      NAME = #{record.name,jdbcType=VARCHAR},
      LANGUAGE = #{record.language,jdbcType=VARCHAR},
      FABULA_TASK_STATUS = #{record.fabulaTaskStatus,jdbcType=INTEGER},
      PREMISE_TASK_STATUS = #{record.premiseTaskStatus,jdbcType=INTEGER},
      SETTING_TASK_STATUS = #{record.settingTaskStatus,jdbcType=INTEGER},
      STRAND_TASK_STATUS = #{record.strandTaskStatus,jdbcType=INTEGER},
      BIBISCO_VERSION = #{record.bibiscoVersion,jdbcType=VARCHAR},
      FABULA = #{record.fabula,jdbcType=CLOB},
      PREMISE = #{record.premise,jdbcType=CLOB},
      SETTING = #{record.setting,jdbcType=CLOB}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    update PUBLIC.PROJECT
    set ID_PROJECT = #{record.idProject,jdbcType=VARCHAR},
      NAME = #{record.name,jdbcType=VARCHAR},
      LANGUAGE = #{record.language,jdbcType=VARCHAR},
      FABULA_TASK_STATUS = #{record.fabulaTaskStatus,jdbcType=INTEGER},
      PREMISE_TASK_STATUS = #{record.premiseTaskStatus,jdbcType=INTEGER},
      SETTING_TASK_STATUS = #{record.settingTaskStatus,jdbcType=INTEGER},
      STRAND_TASK_STATUS = #{record.strandTaskStatus,jdbcType=INTEGER},
      BIBISCO_VERSION = #{record.bibiscoVersion,jdbcType=VARCHAR}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.bibisco.dao.model.ProjectWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    update PUBLIC.PROJECT
    <set>
      <if test="name != null">
        NAME = #{name,jdbcType=VARCHAR},
      </if>
      <if test="language != null">
        LANGUAGE = #{language,jdbcType=VARCHAR},
      </if>
      <if test="fabulaTaskStatus != null">
        FABULA_TASK_STATUS = #{fabulaTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="premiseTaskStatus != null">
        PREMISE_TASK_STATUS = #{premiseTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="settingTaskStatus != null">
        SETTING_TASK_STATUS = #{settingTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="strandTaskStatus != null">
        STRAND_TASK_STATUS = #{strandTaskStatus,jdbcType=INTEGER},
      </if>
      <if test="bibiscoVersion != null">
        BIBISCO_VERSION = #{bibiscoVersion,jdbcType=VARCHAR},
      </if>
      <if test="fabula != null">
        FABULA = #{fabula,jdbcType=CLOB},
      </if>
      <if test="premise != null">
        PREMISE = #{premise,jdbcType=CLOB},
      </if>
      <if test="setting != null">
        SETTING = #{setting,jdbcType=CLOB},
      </if>
    </set>
    where ID_PROJECT = #{idProject,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.bibisco.dao.model.ProjectWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    update PUBLIC.PROJECT
    set NAME = #{name,jdbcType=VARCHAR},
      LANGUAGE = #{language,jdbcType=VARCHAR},
      FABULA_TASK_STATUS = #{fabulaTaskStatus,jdbcType=INTEGER},
      PREMISE_TASK_STATUS = #{premiseTaskStatus,jdbcType=INTEGER},
      SETTING_TASK_STATUS = #{settingTaskStatus,jdbcType=INTEGER},
      STRAND_TASK_STATUS = #{strandTaskStatus,jdbcType=INTEGER},
      BIBISCO_VERSION = #{bibiscoVersion,jdbcType=VARCHAR},
      FABULA = #{fabula,jdbcType=CLOB},
      PREMISE = #{premise,jdbcType=CLOB},
      SETTING = #{setting,jdbcType=CLOB}
    where ID_PROJECT = #{idProject,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.bibisco.dao.model.Project">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 27 00:17:35 CET 2013.
    -->
    update PUBLIC.PROJECT
    set NAME = #{name,jdbcType=VARCHAR},
      LANGUAGE = #{language,jdbcType=VARCHAR},
      FABULA_TASK_STATUS = #{fabulaTaskStatus,jdbcType=INTEGER},
      PREMISE_TASK_STATUS = #{premiseTaskStatus,jdbcType=INTEGER},
      SETTING_TASK_STATUS = #{settingTaskStatus,jdbcType=INTEGER},
      STRAND_TASK_STATUS = #{strandTaskStatus,jdbcType=INTEGER},
      BIBISCO_VERSION = #{bibiscoVersion,jdbcType=VARCHAR}
    where ID_PROJECT = #{idProject,jdbcType=VARCHAR}
  </update>
  <select id="getProjectVersion" parameterType="java.lang.String" resultType="java.lang.String">
    select bibisco_version
    from PUBLIC.PROJECT
    where ID_PROJECT = #{idProject,jdbcType=VARCHAR}
  </select>
  <update id="updateFrom_1_0_0_to_1_1_0">
    ALTER TABLE PUBLIC.SCENE_REVISIONS ADD "WORDS" integer DEFAULT 0 NOT NULL;
    ALTER TABLE PUBLIC.SCENE_REVISIONS ADD "CHARACTERS" integer DEFAULT 0 NOT NULL;
	CREATE VIEW PUBLIC.V_SCENES AS SELECT S.ID_SCENE,S.ID_CHAPTER,S.DESCRIPTION,S.POSITION,
	    S.TASK_STATUS,COALESCE(SR.WORDS,0) AS WORDS, COALESCE(SR.CHARACTERS,0) AS CHARACTERS
		FROM SCENES S
		LEFT JOIN SCENE_REVISIONS SR ON SR.ID_SCENE = S.ID_SCENE AND SR.SELECTED = 'Y'; 
    DROP VIEW PUBLIC.V_CHAPTERS;
    CREATE VIEW PUBLIC.V_CHAPTERS AS
		SELECT C.ID_CHAPTER,C.TITLE,C.POSITION,C.REASON,C.REASON_TASK_STATUS,NOTE, 
		COALESCE(TAB.MIN_SCENES_TASK_STATUS,0) AS MIN_SCENES_TASK_STATUS, 
		COALESCE(TAB.MAX_SCENES_TASK_STATUS,0) AS MAX_SCENES_TASK_STATUS,
		COALESCE(TAB.WORDS,0) AS WORDS, COALESCE(TAB.CHARACTERS, 0) AS CHARACTERS
		FROM CHAPTERS C
		LEFT JOIN (SELECT MIN(TASK_STATUS) AS MIN_SCENES_TASK_STATUS, MAX(TASK_STATUS) AS MAX_SCENES_TASK_STATUS, ID_CHAPTER,
		SUM(WORDS) AS WORDS, SUM(CHARACTERS) AS CHARACTERS
		FROM V_SCENES S GROUP BY ID_CHAPTER) AS TAB ON TAB.ID_CHAPTER = C.ID_CHAPTER;
	DROP VIEW PUBLIC.V_SELECTED_SCENE_REVISIONS;
	CREATE VIEW PUBLIC.V_SELECTED_SCENE_REVISIONS AS
		SELECT SR.ID_SCENE_REVISION,S.ID_SCENE, SR.SCENE, SR.SELECTED, 
		S.POSITION AS SCENE_POSITION, S.DESCRIPTION AS SCENE_DESCRIPTION, S.TASK_STATUS AS SCENE_TASK_STATUS,
		C.POSITION AS CHAPTER_POSITION, C.TITLE AS CHAPTER_TITLE, C.ID_CHAPTER
		FROM SCENE_REVISIONS SR
		JOIN SCENES S on S.ID_SCENE = SR.ID_SCENE
		JOIN CHAPTERS C on C.ID_CHAPTER = S.ID_CHAPTER
		WHERE SR.SELECTED = 'Y';
  </update>
</mapper>